var ccChatFilter=new CicoolChatFilter;function CicoolChat(){this.CHAT_INDICATOR_SENT_ICO='<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 15" width="16" height="15"><path fill="#92A58C" d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z"></path></svg>',this.CHAT_INDICATOR_READ_ICO='<svg id="Layer_1"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 15" width="16" height="15"><path fill="#4FC3F7" d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z"></path></svg>',this.CHAT_INDICATOR_PENDING_ICO='<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 15" width="16" height="15"><path fill="#92A58C" d="M10.91 3.316l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z"></path></svg>',this.messages=[],this.lastChatClass="",this.chatOffset=50,this.intReadMessage=null}CicoolChat.prototype.init=function(){},CicoolChat.prototype.showDateTop=function(t,a){var e=$(".chat-history-wrapper");t?($('.chat-date-separator:not(:contains("'+a+'"))').show(),$(".chat-date-separator:contains('"+a+"')").fadeOut(),0==e.find(".chat-date-current").length?(e.prepend('<div class="chat-date-current" style="margin-top:-50px">\n               '+a+"\n        </div>"),e.find(".chat-date-current").animate({marginTop:10},500)):e.find(".chat-date-current").html(a)):e.find(".chat-date-current").animate({marginTop:-50},500,function(){e.find(".chat-date-current").remove()})},CicoolChat.prototype.addOffset=function(t){this.chatOffset=parseInt(this.chatOffset)+50},CicoolChat.prototype.parseSingleMessage=function(t){var a=t.message_user_id==userId?"user-right":"user-left",e=t.message_user_id==userId?this.getIconStatus(t.status):"",s="";this.lastChatClass==a&&(s="margin-top:-12px"),this.lastChatClass=a;var i=t.uid,o=t.message;return o=ccChatFilter.filter(o,"message"),' <div data-message-id="'+i+'" class="chat-item chat-item-user '+a+'" data-date="'+moment(t.created_at).format("YYYY-MM-DD")+'">\n            <div class="chat-message chat-message-user" style="'+s+'"" >\n              <span class="chat-message-content">'+o+'</span>                    \n              <div class="receiver-stat-icon">\n              '+e+'\n              </div>\n              <span class="chat-time">'+moment(t.created_at).format("HH:mm")+'</span>\n            </div>\x3c!-- \n            <div class="chat-date-time">\n            </div>  --\x3e\n          </div>\n  '},CicoolChat.prototype.parseMessages=function(t){var a="",e=this;return this.messages=t,$.each(t,function(t,s){a+=e.parseSingleMessage(s)}),a},CicoolChat.prototype.humanDate=function(t){var a=moment(t),e=moment(),s=a.format("DD MMM YY");return a.format("YYYY-MM-DD")==e.format("YYYY-MM-DD")&&(s="Today"),1==e.diff(a,"days")&&(s="Yesterday"),e.diff(a,"days")>=2&&e.diff(a,"days")<7&&(s=a.format("dddd")),s},CicoolChat.prototype.grouppingMessage=function(){var t=[],a=this;$("body").find(".chat-item-user").each(function(a,e){var s=$(this).attr("data-date");t.push(s)});var e=t.filter(function(t,a,e){return e.indexOf(t)===a});return $(".chat-date-separator").remove(),$.each(e,function(t,e){var s=a.humanDate(e);$('<div class="chat-date-separator">\n              '+s+"  \n      </div>").insertBefore('.chat-item.chat-item-user[data-date="'+e+'"]:first')}),$(".chat-item-user").each(function(t,a){$(this).find(".chat-image-attchment").length>1?$(this).find(".chat-message-user").addClass("chat-item-user-with-images"):1==$(this).find(".chat-image-attchment").length&&$(this).find(".chat-message-user").addClass("chat-item-user-with-image"),$(this).find(".attachement-files").length>1?$(this).find(".chat-message-user").removeClass("chat-item-user-with-images chat-item-user-with-image").addClass("chat-item-user-with-attachments"):1==$(this).find(".attachement-files").length&&$(this).find(".chat-message-user").removeClass("chat-item-user-with-images chat-item-user-with-image").addClass("chat-item-user-with-attachment"),$(this).find("img").attr("draggable","false")}),this.parseImage(),this.createBigEmoji(),this},CicoolChat.prototype.createBigEmoji=function(t){return $(".chat-item-user").each(function(t,a){var e=$(this).find(".chat-message-content").clone();e.find(".emoji:first").remove(),e.html().length<=0&&$(this).find(".chat-message-content .emoji").addClass("big-emoji")}),this},CicoolChat.prototype.parseImage=function(t){return $(".chat-item-user").each(function(t,a){$(this).find(".chat-image-attchment").length>1?$(this).find(".chat-message-user").addClass("chat-item-user-with-images"):1==$(this).find(".chat-image-attchment").length&&$(this).find(".chat-message-user").addClass("chat-item-user-with-image")}),this},CicoolChat.prototype.getIconStatus=function(t){return"pending"==t?this.CHAT_INDICATOR_PENDING_ICO:"read"==t?this.CHAT_INDICATOR_READ_ICO:this.CHAT_INDICATOR_SENT_ICO},CicoolChat.prototype.newPrivateChat=function(t,a){var e=this;return $.ajax({url:BASE_URL+"administrator/chat/new_private_chat",type:"GET",dataType:"JSON",data:{contact_id:t}}).done(function(t){t.success&&(e.resetBadgeNotif(),a(t.data),$(".chat-message-user-send").focus())}).fail(function(){console.log("error")}).always(function(){console.log("complete")}),this},CicoolChat.prototype.loadMessage=function(t,a,e){var s=this;return $.ajax({url:BASE_URL+"administrator/chat/get_message",type:"GET",dataType:"JSON",data:{chat_id:t,offset:a}}).done(function(t){t.success&&(s.resetBadgeNotif(),e(t.data))}).fail(function(){}).always(function(){}),this},CicoolChat.prototype.loadSearchMessage=function(t,a,e){var s=this;$.ajax({url:BASE_URL+"administrator/chat/get_search_message",type:"GET",dataType:"JSON",data:{chat_id:t,message_id:a}}).done(function(t){t.success&&(s.resetBadgeNotif(),e(t.data))}).fail(function(){}).always(function(){})},CicoolChat.prototype.sendMessage=function(t,a,e,s){var i=[];i.push({name:"chat_id",value:a}),i.push({name:"message",value:e}),i.push({name:"uid",value:t}),i.push({name:csrf,value:token}),this.showDateTop(!1),this.createBigEmoji(),$.ajax({url:BASE_URL+"administrator/chat/send_message",type:"POST",dataType:"JSON",data:i}).done(function(t){t.success&&s(t.data)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},CicoolChat.prototype.getMessage=function(t,a){return $.ajax({url:BASE_URL+"administrator/chat/get_message",type:"GET",dataType:"JSON",data:{chat_id:t}}).done(function(t){t.success&&a(t.data)}).fail(function(){console.log("error")}).always(function(){console.log("complete")}),this},CicoolChat.prototype.parseSingleContact=function(t){var a="";if(void 0!==t.last_message.status&&t.last_message.message_user_id==userId&&(a=this.getIconStatus(t.last_message.status)),void 0!==t.last_message.created_at){var e=moment(t.last_message.created_at).format("DD MMMM");moment(t.last_message.created_at).format("YYYY-MMMM-DD")==moment().format("YYYY-MMMM-DD")&&(e=moment(t.last_message.created_at).format("HH:mm"))}else e="-";var s="";if(void 0!==t.last_message.message)s=ccChatFilter.filter(t.last_message.message,"chatLastMessage");var i=BASE_URL+"/uploads/user/"+t.user.avatar;return'<div class="chat-item"\n            data-id="'+t.chat_uid+'"\n            data-user-id="'+t.user.id+'"\n            data-user-username="'+t.user.username+'"\n            data-user-fullname="'+t.user.full_name+'"\n            data-user-group="'+t.user.group+'"\n             >\n             <div class="chat-contact-icon"><img src="'+i+'" alt=""></div>\n             <div class="chat-header">\n              <div class="chat-date">'+e+"</div>\n              <h4>"+t.user.full_name+'</h4>\n              </div>\n             <div class="chat-body"><div class="chat-last-message" title="">'+a+" "+s+"</div>\n             "+(t.unread>0?'<div class="pull-right counter-incomming-message">'+t.unread+"</div>":"")+'\n             <img class="chat-typing" src="'+BASE_URL+'asset/module/chat/img/typing.svg" width="30px" alt="">\n             </div>\n           </div>\n  '},CicoolChat.prototype.parseContacts=function(t){var a="",e=this;return this.contacts=t,$.each(t,function(t,s){a+=e.parseSingleContact(s)}),a},CicoolChat.prototype.parseSingleSearchItem=function(t){var a="";if(void 0!==t.status&&t.message_user_id==userId&&(a=this.getIconStatus(t.status)),void 0!==t.created_at){var e=moment(t.created_at).format("DD MMMM");moment(t.created_at).format("YYYY-MMMM-DD")==moment().format("YYYY-MMMM-DD")&&(e=moment(t.created_at).format("HH:mm"))}else e="-";return'<div class="chat-item"\n            data-message-id="'+t.uid+'"\n            data-user-id="'+t.user.id+'"\n            data-id="'+t.chat_id+'"\n            data-user-username="'+t.user.username+'"\n            data-user-fullname="'+t.user.full_name+'"\n             >\n             \n             <div class="chat-header">\n              <div class="chat-date">'+e+"</div>\n              <h4>"+t.user.full_name+'</h4>\n              </div>\n             <div class="chat-body"><small>'+(void 0===t.message?"":a+" "+t.message)+"</small></div>\n           </div>\n  "},CicoolChat.prototype.parseSearchResults=function(t){var a="",e=this;return this.contacts=t,$.each(t,function(t,s){a+=e.parseSingleSearchItem(s)}),a},CicoolChat.prototype.getConversations=function(t){$.ajax({url:BASE_URL+"administrator/chat/get_chat",type:"GET",dataType:"JSON",data:{}}).done(function(a){a.success&&t(a.data.chats)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},CicoolChat.prototype.findChats=function(t,a){$.ajax({url:BASE_URL+"administrator/chat/find_chats",type:"GET",dataType:"JSON",data:{q:t}}).done(function(t){t.success&&a(t.data.chats)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},CicoolChat.prototype.readMessage=function(t,a,e){$.ajax({url:BASE_URL+"administrator/chat/read_message",type:"GET",dataType:"JSON",data:{chat_id:t,contact_id:a}}).done(function(t){t.success&&e(t.data.chats)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},CicoolChat.prototype.getConversationUser=function(){return{username:$(".chat-detail-header .chat-detail-username").val(),userId:$(".chat-detail-header .chat-detail-id").val(),chatId:$(".chat-detail-header .chat-id").val()}},CicoolChat.prototype.bottomButtonMessage=function(){var t=this;if($(".chat-contact-detail .chat-history").scrollTop()<$(".chat-contact-detail .chat-history").prop("scrollHeight")-500&&$(".bottom-button-wrapper").fadeIn(),$(".chat-contact-detail .chat-history").scrollTop()>$(".chat-contact-detail .chat-history").prop("scrollHeight")-500&&$(".bottom-button-wrapper").is(":visible")){this.resetBadgeNotif(),$(".bottom-button-wrapper").fadeOut();var a=this.getConversationUser().chatId,e=this.getConversationUser().userId;clearInterval(this.intReadMessage),this.intReadMessage=setTimeout(function(){t.readMessage(a,e,function(){$('.chat-item[data-id="'+a+'"]').find(".counter-incomming-message").fadeOut()})},1e3)}this.toggleBadge()},CicoolChat.prototype.toggleBadge=function(){0==$(".badge-count-will-read").html()?$(".badge-count-will-read").hide():$(".badge-count-will-read").show()},CicoolChat.prototype.addBadgeNotif=function(){var t=$(".badge-count-will-read");return $(".bottom-button-wrapper").is(":visible")&&(t.show(),t.html(parseInt(t.html())+1)),this},CicoolChat.prototype.resetBadgeNotif=function(){$(".badge-count-will-read").html("0"),this.toggleBadge()},CicoolChat.prototype.showLoadingChat=function(t){return t?$(".loading-chat-wrapper").html('\n      <div class="loading-chat">\n          <img src="'+BASE_URL+'asset/module/chat/img/loading.svg" width="40px" alt="">\n      </div>\n      '):$(".loading-chat-wrapper").html(""),this},CicoolChat.prototype.notify=function(t){return toastr.options={positionClass:"toast-bottom-right",newestOnTop:!1},toastr.info(ccChatFilter.filter(t.message,"liveMessage"),t.user_full_name),this};